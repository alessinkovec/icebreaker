$(document).ready((function(_this) {
 return function() {
   var channel, pusher, updateChat, username;
   username = '';
   updateChat = function(data) {


     var ev = $('.chat-box').attr('id');
     var user = $('.chat-text-input').attr('id');
     // console.log(ev);



     if (ev == data.event_id) {
       // $('.chat-box').append("<div class=\"chat-all\"> <div class=\"pic-name\"> <img class=\"penguin\" src=\"https://vignette.wikia.nocookie.net/farmville/images/e/e9/White_Baby_Penguin-icon.png/revision/latest?cb=20121101164636\"><br>" + data.username + "</div> <div class=\"chat-bubble\"> <p class=\"m-0 chat-message\">"  + data.message + "</p> </div></div>");

       if(user == data.username) {
        $('.chat-box').append("<div class=\"chat-all\"><div class=\"chat-bubble\" id=\"bubble\"><p class=\"m-0 chat-message\">" + data.message + "</div><div class=\"pic-name\"><img class=\"penguin\" src=\"https://vignette.wikia.nocookie.net/farmville/images/e/e9/White_Baby_Penguin-icon.png/revision/latest?cb=20121101164636\"><br>" + data.username + "</div></div>");
      }else{
        $('.chat-box').append("\n<div class=\"chat-all\"id=\"chat-all2\">\n<div class=\"pic-name\">\n<img class=\"penguin\" src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTO_v8ReA8GFkfLV3V4Hv43b9zO3VWtLpMnzm9chfh3dz-zkAWW\">\n<br>\n" + data.username + "\n</div>\n<div class=\"chat-bubble\" id=\"bubble2\">\n<p class=\"m-0 chat-message\">" + data.message + "</p>\n</div>\n</div>\n");
      }
    }

  };
  $('#chat-form').on('ajax:success', function(data) {
   $('#chat-form')[0].reset();
 });

  pusher = new Pusher('<%= ENV["PUSHER_KEY"] %>', {
   cluster: '<%= ENV["PUSHER_CLUSTER"] %>',
   encrypted: true
 });

  channel = pusher.subscribe('chat');
  channel.bind('new', function(data) {
   updateChat(data);
 });
};
})(this));
